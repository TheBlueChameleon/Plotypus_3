#include "dataview.h"

using namespace Plotypus;

namespace Plotypus
{
    DataView::DataView(const DataViewType type, const PlotStyle plotStyleID) :
        type(type), title(std::optional<std::string>())
    {
        setPlotStyleID(plotStyleID);
    }

    DataView::DataView(const DataViewType type, const PlotStyle plotStyleID, const std::string& title) :
        type(type), title(title)
    {
        setPlotStyleID(plotStyleID);
    }

    DataView::DataView(const DataViewType type, const std::string& plotStyle) :
        type(type), title(std::optional<std::string>()), plotStyle(plotStyle), plotStyleID(PlotStyle::Custom)
    {}

    DataView::DataView(const DataViewType type, const std::string& plotStyle, const std::string& title) :
        type(type), title(title), plotStyle(plotStyle), plotStyleID(PlotStyle::Custom)
    {}

    // ====================================================================== //

    DataView& DataView::reset()
    {
        plotStyleID                     = PlotStyle::Custom;
        plotStyleFamily                 = PlotStyleFamily::Undefined;
        title                       = "";
        plotStyle                       = "lines";
        options                     = "";
        dataFilename                = "";
        numberPrecision             = -1;
        columnSeparatorTxt          = "\t";
        columnSeparatorDat          = "\t";
        binaryDataOutput            = true;
        autoGenerateDataFilename    = true;

        return *this;
    }

    DataViewType DataView::getType() const
    {
        return type;
    }

    const std::string DataView::getTitle() const
    {
        return title.value_or("");
    }

    DataView& DataView::setTitle(const std::string& newTitle)
    {
        title = newTitle;
        return *this;
    }

    DataView& DataView::clearTitle()
    {
        title.reset();
        return *this;
    }

    const std::string& DataView::getPlotStyle() const
    {
        return plotStyle;
    }

    DataView& DataView::setPlotStyle(const std::string& newPlotStyle)
    {
        plotStyleID     = PlotStyle::Custom;
        plotStyleFamily = PlotStyleFamily::Custom;
        plotStyle       = newPlotStyle;
        return *this;
    }

    PlotStyleFamily DataView::getPlotStyleFamily() const
    {
        return plotStyleFamily;
    }

    DataView& DataView::setPlotStyleFamily(PlotStyleFamily newStyleFamily)
    {
        if (plotStyleID == PlotStyle::Custom)
        {
            plotStyleFamily = newStyleFamily;
        }
        else
        {
            throw UnsupportedOperationError("Cannot override style family for non-custom plot style.");
        }

        return *this;
    }

    const PlotStyle DataView::getPlotStyleID() const
    {
        return plotStyleID;
    }

    DataView& DataView::setPlotStyleID(const PlotStyle newStyle)
    {
        plotStyleID     = newStyle;
        plotStyleFamily = ::Plotypus::getPlotStyleFamily(newStyle);
        plotStyle       = getPlotStyleName(newStyle);
        return *this;
    }

    const std::string DataView::getOptions() const
    {
        return options.value_or("");
    }

    DataView& DataView::setOptions(const std::string& newOptions)
    {
        options = newOptions;
        return *this;
    }

    DataView& DataView::clearOptions()
    {
        options.reset();
        return *this;
    }

    const std::string& DataView::getDataFilename() const
    {
        return dataFilename;
    }

    DataView& DataView::setDataFilename(const std::string& newDataFilename)
    {
        throwIfInvalidFilename("data output filename", newDataFilename);
        dataFilename = newDataFilename;
        return *this;
    }

    bool DataView::getAutoGenerateDataFilename() const
    {
        return autoGenerateDataFilename;
    }

    DataView& DataView::setAutoGenerateDataFilename(bool newAutoGenerateDataFilename)
    {
        autoGenerateDataFilename = newAutoGenerateDataFilename;
        return *this;
    }

    int DataView::getNumberPrecision() const
    {
        return numberPrecision;
    }

    DataView& DataView::setNumberPrecision(int newNumberPrecision)
    {
        numberPrecision = newNumberPrecision;
        return *this;
    }

    const std::string& DataView::getColumnSeparatorTxt() const
    {
        return columnSeparatorTxt;
    }

    DataView& DataView::setColumnSeparatorTxt(const std::string& newSeparatorTXT)
    {
        columnSeparatorTxt = newSeparatorTXT;
        return *this;
    }

    const std::string& DataView::getColumnSeparatorDat() const
    {
        return columnSeparatorDat;
    }

    DataView& DataView::setColumnSeparatorDat(const std::string& newSeparatorDAT)
    {
        columnSeparatorDat = newSeparatorDAT;
        return *this;
    }

    bool DataView::getBinaryDataOutput() const
    {
        return binaryDataOutput;
    }

    DataView& DataView::setBinaryDataOutput(bool newBinaryDataOutput)
    {
        binaryDataOutput = newBinaryDataOutput;
        return *this;
    }
}
